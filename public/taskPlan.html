<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <!-- 引入 -->
    <link href="./gantt/gantt/styles/font-awesome.min.css" rel="stylesheet" />
    <link href="./gantt/gantt/scripts/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="./gantt/gantt/jeasyui/themes/insdep/default_theme.css" rel="stylesheet" type="text/css">
    <link href="./gantt/gantt2.5.1/ext-min/resources/css/ext-all.css" rel="stylesheet" type="text/css" />
    <link href="./gantt/gantt2.5.1/ext-min/packages/ux/classic/triton/resources/ux-all.css" rel="stylesheet" type="text/css" />
    <link href="./gantt/gantt2.5.1/resources/theme-triton/css/sch-gantt-triton-all.css" rel="stylesheet" type="text/css"/>
    <link href="./gantt/gantt2.5.1/ext-min/theme-triton/resources/theme-triton-all.css" rel="stylesheet" type="text/css"/>
    <link href="./gantt/gantt2.5.1/resources/css/sch-gantt-all.css?ver=2.5.1" rel="stylesheet" type="text/css" />
    <link href="./gantt/gantt2.5.1/examples/gantt-scheduler/resources/css/gantt-scheduler.css" rel="stylesheet" type="text/css" />
    <link href="./gantt/gantt2.5.1/examples/gantt-scheduler/resources/css/style.css" rel="stylesheet" type="text/css" />
    <link href="./gantt/gantt/css/app.css" rel="stylesheet" type="text/css" />
    <link href="./gantt/easyui/uimaker/easyui.css" rel="stylesheet" type="text/css">
    <link href="./gantt/easyui/uimaker/icon.css" rel="stylesheet" type="text/css">
    <link href="./gantt/easyui/theme/simple/master.css" rel="stylesheet" type="text/css">
    <link href="./gantt/css/main.css" rel="stylesheet" media="all">
    <link href="./gantt/css/add.css" rel="stylesheet" media="all">


    <script src="./gantt/gantt/jeasyui/jquery.min.js"></script>
    <script src="./gantt/js/major.ui.js"></script>
    <script src="./gantt/gantt/scripts/bootstrap/bootstrap.min.js"></script>
    <script src="./gantt/gantt/jeasyui/jquery.easyui.min.js"></script>
    <script src="./gantt/gantt/jeasyui/themes/insdep/jquery.insdep-extend.min.js"></script>
    <script src="./gantt/gantt/scripts/plugins/uploadify/ajaxfileupload.js"></script>
    <script src="./gantt/gantt/scripts/plugins/datetime/moment.min.js"></script>
    <script src="./gantt/gantt/scripts/utils/major-ui.js?DEV_20171212"></script>
    <script src="./gantt/gantt/jeasyui/jquery.easyui.extend.js?DEV_20171212"></script>
    <script src="./gantt/js/comon.js"></script>
    <script src="./gantt/gantt/scripts/major/mootools/Core/Core.js?DEV_20171212"></script>
    <script src="./gantt/gantt/scripts/major/mootools/Class/Class.js?DEV_20171212"></script>
    <script src="./gantt/gantt/scripts/major/mootools/Types/Array.js?DEV_20171212"></script>
    <script src="./gantt/gantt/scripts/major/mootools/Types/Function.js?DEV_20171212"></script>
    <script src="./gantt/gantt/scripts/major/mootools/Types/Number.js?DEV_20171212"></script>
    <script src="./gantt/gantt/scripts/major/mootools/Types/Object.js?DEV_20171212"></script>
    <script src="./gantt/gantt/scripts/major/mootools/Types/String.js?DEV_20171212"></script>
    <script src="./gantt/gantt2.5.1/ext-min/ext-all-debug.js" type="text/javascript"></script>
    <script src="./gantt/gantt/scripts/utils/major-gantt-helper.js?DEV_20171212" type="text/javascript"></script>
    <script src="./gantt/gantt2.5.1/gnt-all-debug-b.js?ver=2.5.1" type="text/javascript"></script>
    <script src="./gantt/gantt2.5.1/sch-all-debug-b.js?ver=2.5.1" type="text/javascript"></script>
    <script src="./gantt/gantt2.5.1/js/Gnt/locale/Zh.js" type="text/javascript"></script>
</head>
<!--body添加.skin-bg  显示主题蓝色背景-->

<body class="skin-bg l-bg-body">
<!--内容外添加.container显示最外层div样式 -->
<div class="container l-container-Outer">
    <!--大的单页标题添加.cont-title 显示标题样式 -->
    <div class="cont-title">
        <div class="cont-title-main">
            <label>月事件任务规划</label>
        </div>
        <div class="cont-title-bt"></div>
    </div>
    <!--单页头部搜索条件添加.cont-search 显示索引样式 -->
    <div class="cont-btns">
        <div class="breadcrumb">
            <span>位置：场景规划 </span> > <span style="color: aqua">月事件任务规划</span>
        </div>

        <div class="btn-group-right">
            <div class="breadcrumb">
                <span style="color: aqua">部门图例：</span>
                <div style="width:10px;height:10px;background:#F2602C;display:inline-block"></div>
                <span style="margin-right: 10px">航天员系统</span>
                <div style="width:10px;height:10px;background:#77AC3A;display:inline-block"></div>
                <span style="margin-right: 10px">空间应用系统</span>
                <div style="width:10px;height:10px;background:#51D6F7;display:inline-block"></div>
                <span style="margin-right: 10px">空间站平台系统</span>
            </div>
            <a href="javascript:void(0)" style="width: 120px;white-space:nowrap;"
               class="easyui-linkbutton z-head-btn" onclick="showAutoPlan()">
                <i class="iconfont icon-icon01"></i>智能规划</a>
            <a href="javascript:void(0)" style="width: 120px;white-space:nowrap;"
               class="easyui-linkbutton z-head-btn" id="save">
                <i class="iconfont icon-xinzengruku"></i>保存</a>
            <a href="#" class="z-resource-btn" style="float: right;color: #ffffff;" id="discussBtn"> <i
                    class="iconfont icon-shenhe"></i> 发起研讨</a>
        </div>
    </div>

    <div class="list-wrap z-demand-table" id="ganttContainer" style="width: 100%; height: 80%;">
        <!-- <div id="gantt" style="width: 100%;height: 68%;"></div> -->
        <!-- <div id="scheduler" style="width: 100%;height: 30%;"></div> -->
        <span class="corner-1"></span>
        <span class="corner-2"></span>
        <span class="corner-3"></span>
        <span class="corner-4"></span>
    </div>



    <div id="createTaskWnd" style="display: none;">
        <iframe src="" frameborder="0" id="createTaskFrame" style="width: 100%;height: 98%;"></iframe>
    </div>


    <div id="assignResourceDiv" style="display: none;">
        <iframe src="" frameborder="0" id="assignResourceFrame" style="width: 100%;height: 100%;"></iframe>
    </div>


    <div id="ldSelectWnd" style="display: none;">
        <iframe src="" frameborder="0" id="ldSelectFrame" style="width: 100%;height: 98%;"></iframe>
    </div>

    <div id="discuss" class="easyui-dialog" title="发起研讨" style="width:1100px;height:800px;overflow: hidden;">
        <div title="研讨" style="padding:30px;box-sizing: border-box">
            <iframe style="width:100%;height:800px;padding-bottom: 10px;" src="../HWME/基本信息.html"
                    frameborder="0"></iframe>
        </div>
    </div>

    <!--智能规划窗口-->
    <div id="autoPlanWnd" class="easyui-dialog l-camp-window" title="智能规划" style="display: none; width: 1000px; height: 800px;">
        <div class="easyui-layout" fit="true">
            <div data-options="region: 'center'">
                <form id="autoPlanForm" class="w-create-from">
                    <div class="form-row group-title">方案设置：</div>
                    <div class="form-row" style="margin-top: 50px">
                        <label class="title">任务分布</label>
                        <div class="content">
                            <label><input type="radio" name="fenbu" value="1">紧凑模式</label>
                            <label><input type="radio" name="fenbu" value="2">宽松模式</label>
                            <label>权重<input type="text" name="fenbuWeight" value="30"></label>
                        </div>
                    </div>
                    <div class="form-row" style="margin-top: 50px">
                        <label class="title">任务规划</label>
                        <div class="content">
                            <label><input type="radio" name="youxian" value="1">任务优先</label>
                            <label><input type="radio" name="youxian" value="2">资源优先</label>
                            <label><input type="radio" name="youxian" value="2">约束优先</label>
                            <label>权重<input type="text" name="youxianWeight" value="30"></label>
                        </div>
                    </div>
                    <div class="form-row" style="margin-top: 50px">
                        <label class="title">资源设置</label>
                        <div class="content">
                            <label><input type="radio" name="ziyuan" value="1">最少资源使用</label>
                            <label><input type="radio" name="ziyuan" value="2">平均资源分布</label>
                            <label>权重<input type="text" name="ziyuanWeight" value="30"></label>
                        </div>
                    </div>

                    <div class="form-row group-title">高级设置：</div>
                    <div class="form-row">
                        <label class="title">搜索方式</label>
                        <div class="content">
                            <label><input type="checkbox" name="tuihuo">模拟退火</label>
                            <label><input type="checkbox" name="yuanqifa">元启发法</label>
                            <label><input type="checkbox" name="kongjiansousuo">空间搜索</label>
                            <label><input type="checkbox" name="bendisousuo">本地搜索</label>
                        </div>
                    </div>
                    <div class="form-row">
                        <label class="title">结束方式</label>
                        <div class="content">


                            <label><input type="radio" name="jieshu" value="zuikuai">最快求解</label>
                            <label><input type="radio" name="jieshu" value="shougong">手工结束</label>
                            <label><input type="radio" name="jieshu" value="meiyou"><input type="text" name="meiyouTime" size="6">秒没有更优解结束</label>
                            <label><input type="radio" name="jieshu" value="zuiyou"><input type="text" name="zuiyouTime" size="6">秒内的最优解</label>
                        </div>
                    </div>

                    <div class="z-btn z-create-footer-btn">
                        <a href="#" class="z-create-btn" id="startPlanning">开始规划</a>
                    </div>
                </form>
            </div>
            <div data-options="region: 'east'" style="width: 500px;">
                <div style="display: inline-block; width: 62%; height: 100%;">
                    <table id="historyTable"></table>
                </div>
                <div style="display: inline-block; width: 35%; height: 100%;">
                    <table id="favTable"></table>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    var ganttConfig = {
        autoInit: true,
        title: '任务列表',
        gridNameTitle: '名称',
        taskType: 'task_ok',
        showHistogram: true
    };

    var planResultMap = {};  // 规划结果的id与甘特数据(应用了规划结果)的映射
    $(function () {
        $("#discuss").dialog({
            closed: true,
        })
        $('#discussBtn').bind('click', () => {
            $('#discuss').window('open')
        })
        $('#save').bind('click', function () {
            $.messager.alert({
                title: '请确认',
                msg: '月事件任务规划保存成功',
            });
        })

        // 开始智能规划按钮
        $("#startPlanning").on('click', function(){
            var planConfig = major.serializeObject($("#autoPlanForm"));
            $.post("/bs/scene/plan/start", {
                config: JSON.stringify(planConfig),
                ganttData: JSON.stringify(window.ganttData)
            }, function(rst){
                setTimeout(function(){
                    $("#historyTable").treegrid('reload');
                }, 1000);
            });
        });

        $('#autoPlanWnd').window({
            width: 1000,
            height: 800,
            closed: true,
            resizable: true,
            modal: true,
            buttons: [{
                text: '关闭',
                handler: function () {
                    // alert('cancel');
                    $('#autoPlanWnd').dialog('close');

                }
            }],
        });

        $("#historyTable").treegrid({
            url: '/bs/scene/plan/planHistory',
            animate: false,
            idField:'id',
            treeField: 'name',
            parentField: 'pid',
            lines: false,
            fit:true,
            fitColumns:true,
            emptyMsg : '暂无规划历史',
            border: false,
            checkbox:true,
            cascadeCheck:false,
            showLoading:false,
            // showHeader: false,
            columns : [ [
                {field:'name',title:'方案', width:280,align:'left',sortable:false,type:"string",editor:'text'
                },
                {field:'op',width:100,align:'left',sortable:false,type:"string",editor:'text',
                    formatter:function(value,row,index){
                        if (row.nodeType === "leaf") {
                            return '<a href="javascript:void(0)" style="color:white; margin-right: 6px;" onclick="loadGantt(' + row.batchId + ', ' + row.dataId + ','+row.id + ')">上图</a>' +
                                '<a href="javascript:void(0)" style="color:white; margin-right: 6px;" onclick="favScheme(' + row.id + ')">收藏</a>';
                        } else {
                            return "";
                        }
                    }
                }
            ]],
            onExpand: function(node) {
                var nodeId = node.id;
                flush();
                setInterval(flush, 1000);
                function flush() {
                    $.ajax('/bs/scene/plan/planHistory', {
                        showLoading: false,
                        data: {
                            id: nodeId
                        },
                        success: function(rst) {
                            console.log('rst', rst);
                        }
                    })
                }
            },
            onLoadSuccess:function(row,data){
            },
            onCheckNode:function(row,checked){

            }
        })

        // 收藏的方案
        $('#favTable').datagrid({
            // title: '收藏方案',
            url : '/bs/scene/plan/favSchemeList',
            pagination : false,
            fit:true,
            fitColumns:true,
            border:false,
            singleSelect: true,
            showLoading:false,
            columns : [ [
                {field:'name',title:'收藏的方案',align:'left',sortable:true,type:"string",editor:'text', width: 180,
                    formatter:function(value,row,index){
                        return row.name;
                    }
                }] ],
            onSelect: function(index, node){

            }
        });
    });

    // 弹出智能规划窗口
    function showAutoPlan() {
        $("#autoPlanWnd").dialog('open');
    }

    // 上图
    function loadGantt(batchId, dataId, index) {
        gantt.crudManager.transport.load.url = "/bs/scene/plan/gotSchemeGanttData";
        gantt.crudManager.transport.load.params = {
            batchId: batchId,
            dataId: dataId,
            index: index
        };
        gantt.crudManager.load();
    }
    // 收藏方案
    function favScheme(schemeId) {
        $.post("/bs/scene/plan/saveScheme", {
            schemeId: schemeId
        })
    }
</script>
<script src="./gantt/app/gantt/planMonth/app.js" type="text/javascript"></script>
<style>
    .form-row{
        display: flex;
    }
    .form-row label{
        color: #ffffff;
        margin: 2px 10px
    }
    .form-row .title{
        width: 6em;
    }
    .form-row .content{
        width: calc(100% - 6em);
    }
    .form-row label input{
        text-align: center;
        width: 30px;
        margin:0 10px;
    }
    #autoPlanForm{
        padding: 10px;
    }
    .z-create-footer-btn{
        width: auto;
    }
    .z-create-footer-btn a{
        color: #fff;
    }

</style>


</body>

</html>